<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mermaid æµç¨‹å›¾æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: #f8fafc;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1e293b;
            border-bottom: 2px solid #3b82f6;
            padding-bottom: 10px;
        }
        .test-section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background: #f8fafc;
        }
        .test-title {
            color: #3b82f6;
            font-weight: 600;
            margin-bottom: 15px;
        }
        .markdown-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        pre {
            background: #1e293b;
            color: #f1f5f9;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
        }
        code {
            font-family: 'Monaco', 'Cascadia Code', 'Consolas', monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª Mermaid æµç¨‹å›¾æ¸²æŸ“æµ‹è¯•</h1>
        
        <div class="test-section">
            <div class="test-title">æµ‹è¯•1: åŸºæœ¬æµç¨‹å›¾</div>
            <div class="markdown-content">
                <p>è¿™æ˜¯ä¸€ä¸ªåŸºæœ¬çš„æµç¨‹å›¾ç¤ºä¾‹ï¼š</p>
                <pre><code class="language-mermaid">
flowchart TD
    A[å¼€å§‹] --> B{æ¡ä»¶åˆ¤æ–­}
    B -->|æ˜¯| C[æ‰§è¡Œæ“ä½œA]
    B -->|å¦| D[æ‰§è¡Œæ“ä½œB]
    C --> E[ç»“æŸ]
    D --> E
                </code></pre>
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">æµ‹è¯•2: åºåˆ—å›¾</div>
            <div class="markdown-content">
                <p>ç”¨æˆ·ç™»å½•åºåˆ—å›¾ï¼š</p>
                <pre><code class="language-mermaid">
sequenceDiagram
    participant ç”¨æˆ·
    participant å‰ç«¯
    participant åç«¯
    participant æ•°æ®åº“
    
    ç”¨æˆ·->>å‰ç«¯: è¾“å…¥ç”¨æˆ·åå¯†ç 
    å‰ç«¯->>åç«¯: å‘é€ç™»å½•è¯·æ±‚
    åç«¯->>æ•°æ®åº“: éªŒè¯ç”¨æˆ·ä¿¡æ¯
    æ•°æ®åº“-->>åç«¯: è¿”å›éªŒè¯ç»“æœ
    åç«¯-->>å‰ç«¯: è¿”å›JWT Token
    å‰ç«¯-->>ç”¨æˆ·: ç™»å½•æˆåŠŸ
                </code></pre>
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">æµ‹è¯•3: ç”˜ç‰¹å›¾</div>
            <div class="markdown-content">
                <p>é¡¹ç›®å¼€å‘æ—¶é—´çº¿ï¼š</p>
                <pre><code class="language-mermaid">
gantt
    title åšå®¢ç³»ç»Ÿå¼€å‘è®¡åˆ’
    dateFormat  YYYY-MM-DD
    section åç«¯å¼€å‘
    APIè®¾è®¡      :a1, 2024-01-01, 30d
    æ•°æ®åº“è®¾è®¡   :after a1, 20d
    è®¤è¯ç³»ç»Ÿ     :2024-02-01, 25d
    section å‰ç«¯å¼€å‘
    é¡µé¢è®¾è®¡     :2024-01-15, 45d
    äº¤äº’å¼€å‘     :2024-02-15, 30d
    é›†æˆæµ‹è¯•     :2024-03-01, 15d
                </code></pre>
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">æµ‹è¯•4: çŠ¶æ€å›¾</div>
            <div class="markdown-content">
                <p>æ–‡ç« çŠ¶æ€æµè½¬ï¼š</p>
                <pre><code class="language-mermaid">
stateDiagram-v2
    [*] --> è‰ç¨¿
    è‰ç¨¿ --> å¾…å®¡æ ¸: æäº¤å®¡æ ¸
    å¾…å®¡æ ¸ --> å·²å‘å¸ƒ: å®¡æ ¸é€šè¿‡
    å¾…å®¡æ ¸ --> è‰ç¨¿: å®¡æ ¸æ‹’ç»
    å·²å‘å¸ƒ --> å·²ä¸‹çº¿: ä¸‹çº¿
    å·²ä¸‹çº¿ --> å·²å‘å¸ƒ: é‡æ–°å‘å¸ƒ
    è‰ç¨¿ --> [*]: åˆ é™¤
    å·²ä¸‹çº¿ --> [*]: åˆ é™¤
                </code></pre>
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">æµ‹è¯•5: é”™è¯¯è¯­æ³•æµ‹è¯•</div>
            <div class="markdown-content">
                <p>è¿™æ˜¯ä¸€ä¸ªæ•…æ„åŒ…å«é”™è¯¯è¯­æ³•çš„å›¾è¡¨ï¼š</p>
                <pre><code class="language-mermaid">
flowchart TD
    A[å¼€å§‹] --> B{é”™è¯¯è¯­æ³•
    B -->|æ˜¯| C[æ“ä½œA
    C --> E[ç»“æŸ
                </code></pre>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked@latest/marked.min.js"></script>
    <script>
        // æ¨¡æ‹Ÿåšå®¢ç³»ç»Ÿçš„æ¸²æŸ“é€»è¾‘
        
        // åˆå§‹åŒ–Mermaid
        mermaid.initialize({
            startOnLoad: false,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true
            },
            sequence: {
                useMaxWidth: true
            },
            gantt: {
                useMaxWidth: true
            }
        });

        // æ¸²æŸ“Mermaidå›¾è¡¨å‡½æ•°
        async function renderMermaidCharts(container) {
            if (typeof mermaid === 'undefined') {
                console.warn('Mermaid åº“æœªåŠ è½½');
                return;
            }
            
            try {
                const mermaidBlocks = container.querySelectorAll('pre code.language-mermaid, code.language-mermaid');
                
                for (let i = 0; i < mermaidBlocks.length; i++) {
                    const block = mermaidBlocks[i];
                    const mermaidCode = block.textContent || block.innerText;
                    
                    const mermaidDiv = document.createElement('div');
                    mermaidDiv.className = 'mermaid-chart';
                    mermaidDiv.id = `mermaid-${Date.now()}-${i}`;
                    
                    const preElement = block.closest('pre') || block;
                    preElement.parentNode.insertBefore(mermaidDiv, preElement);
                    preElement.remove();
                    
                    try {
                        const { svg } = await mermaid.render(mermaidDiv.id + '-svg', mermaidCode);
                        mermaidDiv.innerHTML = svg;
                        
                        // æ·»åŠ æ ·å¼
                        Object.assign(mermaidDiv.style, {
                            textAlign: 'center',
                            margin: '20px 0',
                            padding: '16px',
                            border: '1px solid #e2e8f0',
                            borderRadius: '8px',
                            backgroundColor: '#fff',
                            boxShadow: '0 1px 3px rgba(0,0,0,0.1)'
                        });
                        
                        console.log(`Mermaid å›¾è¡¨ ${i + 1} æ¸²æŸ“æˆåŠŸ`);
                    } catch (renderError) {
                        console.error(`Mermaid å›¾è¡¨æ¸²æŸ“å¤±è´¥:`, renderError);
                        mermaidDiv.innerHTML = `
                            <div style="color: #e74c3c; padding: 12px; border: 1px solid #e74c3c; border-radius: 8px; background: #fdf2f2; text-align: left;">
                                <strong style="display: block; margin-bottom: 4px;">æµç¨‹å›¾æ¸²æŸ“å¤±è´¥</strong>
                                <small style="opacity: 0.8;">è¯·æ£€æŸ¥è¯­æ³•æ˜¯å¦æ­£ç¡®</small>
                            </div>
                        `;
                        Object.assign(mermaidDiv.style, {
                            margin: '20px 0',
                            textAlign: 'center'
                        });
                    }
                }
            } catch (error) {
                console.error('å¤„ç† Mermaid å›¾è¡¨æ—¶å‡ºé”™:', error);
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ¸²æŸ“å›¾è¡¨
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('å¼€å§‹æ¸²æŸ“ Mermaid å›¾è¡¨...');
            await new Promise(resolve => setTimeout(resolve, 500)); // ç­‰å¾…åº“åŠ è½½
            await renderMermaidCharts(document.body);
            console.log('Mermaid å›¾è¡¨æ¸²æŸ“å®Œæˆ');
        });
    </script>
</body>
</html>